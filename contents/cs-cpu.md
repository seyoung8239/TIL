---
createdAt: 2023-03-15
title: 컴퓨터구조 CPU의 작동 원리
summary: ALU, Cotrol Unit, Register, Instruction Cycle, interuption
categories: ['ALU', 'Cotrol Unit', 'Register', 'Instruction Cycle', 'interuption']
---
# 컴퓨터구조: CPU의 작동 원리

# ALU와 제어장치

## ALU

### ALU input

- 레지스터로부터 피연산자를 받는다
- 제어장치로부터 수행할 연산을 알려주는 제어 신호를 받는다

### ALU output

- 플래그 래지스터에 연산 결과와 관련된 정보를 기록한다
- 레지스터에 연산 결과를 기록한다

### flag

- 부호 플래그: 1이면 음수
- 제로 플래그: 1이면 0
- 캐리 플래그: 1이면 올림이나 빌림 발생
- 오버플로우 플래그: 1이면 연산결과 넘침
- 인터럽트 플래그: 1이면 인터럽트 허용
- 슈퍼바이저 플래그: 1이면 커널모드

## 제어장치

- 제어 신호를 송수신 하고 명령어를 해석한다
- 컴퓨터 부품들을 제어하는 장치

### input

- 플래그 레지스터
- 명령어 레지스터
- clock
- 다른 부품에서 오는 제어신호

### output

- 레지스터 제어신호
- ALU 제어신호
- 메모리 제어신호
- IO 제어신호

### Clock

- 클록이란 컴퓨터의 동작이 실행되는 단위 시간이다
- 클록 펄스에 맞추어 시작되거나 종료된다
- 하나의 명령이 여러 클록에 걸쳐 수행될 수 있다

### 명령어 레지스터

제어 장치는 명령어 레지스터에 담긴 명령어만 처리한다

### 플래그 레지스터

- 플래그 레지스터는 연산 혹은 CPU 상태에 대한 정보를 담고 있다
- control unit은 항상 이 플래그 레지스터의 정보를 반영하여 제어한다

### 시스템 버스 (제어버스)

- CU는 시스템 버스 중에서도 제어 버서로부터 오는 제어 신호를 받아서 처리한다
- 주로 입출력장치 같은 외부 장치로부터 신호가 온다

# 레지스터

## 다양한 레지스터의 종류

- 프로그램 카운터 PC

메모리에서 가져올 다음 명령어의 주소를 가르킨다

- 명령어 레지스터

메모리에서 가져온 명령어를 담아둔다

- 메모리 주소 레지스터
    - 읽거나 쓸 메모리의 주소를 관리한다.
    - 주소 버스를 통해 주고보낼 값이 담긴다.
- 메모리 버퍼 레지스터
    - 메모리로부터 읽거나 쓸 값(데이터, 명령어)를 담는다.
        - 데이터 버스를 통해 주고받을 값이 담긴다.
- 범용 레지스터

범용적으로 사용된다. 데이터나 주소를 저장할 때 사용한다

- 플래그 레지스터

ALU 연산 결과에 따른 플래그를 저장한다

## 한 명령어를 읽는 과정

1. 프로그램 카운터에 1000이 들어있다
2. PC의 값이 메모리 주소 레지스터로 이동한다
3. MAR에 담긴 주소가 주소 버스를 통해 메모리로 전달된다.
    1. 동시에 제어신호는 제어 버스를 통해 메모리를 읽으라는 제어 신호를 보낸다.
4. 해당 주소에 담긴 명령어는 데이터 버스를 타고 MBR에 저장된다
    1. 동시에 PC가 +1 된다
5. MBR에 담긴 명령어가 명령어 레지스터로 이동한다
6. 위 과정이 반복되며 프로그램이 실행된다

<aside>
💡 **순차적인 실행 흐름이 끊기는 경우**
일반적으로 실행흐름이 이동하거나(JUMP, CONDITIONAL JUMP, CALL, RETURN)
Interupt가 발생한 경우 순차 실행 흐름이 끊긴다.

</aside>

## 특정 레지스터를 이용한 주소 지정 방식

### 스택 주소 지정 방식

- 메모리의 스택영역의 최상위 주소를 가르키고 있다.
- 서브루틴을 처리하는 경우 어디로 돌아갈지 등을 담고 있다(call stack)

### 상대 주소 지정 방식

- PC + operand(offset)을 통해 유효 주소를 얻는 방식이다.
- 분기문에서 사용된다

### 베이스 레지스터 주소 지정 방식

- base register + operand(offset)을 통해 유효 주소를 얻는 방식이다

# 명령어 사이클과 인터럽트

## 명령어 사이클

- 프로그램 속 명령어들이 일정한 주기 속에서 실행되는 것을 의미한다
- 메모리에 있는 명령어를 CPU로 가져오는 것을 `인출 사이클`이라고 한다
- 인출한 명령어를 실행하는 것이 `실행 사이클`이다
- 간접 주소 지정 방식을 사용 하는 경우 한 번 더 메모리에 접근하는 `간접 사이클`이 발생한다.

## 인터럽트

CPU는 인터럽트를 받은 경우 수행중인 작업을 일시 정지한다.

### 동기 인터럽트

- 명령어를 수행하다가 예상치 못한 상황을 마주칠 때 발생
- 프로그래밍상의 오류가 발생했을 때 발생하는 인터럽트이다
- 예외라고도 불리며 그 종류는 아래와 같다
    - 폴트: 필요한 데이터가 없는 경우 발생, 필요한 데이터를 확보 후 다시 해당 명령을 수행한다.
    - 트랩: 디버거와 같은 break point가 동작할 때, 예외 발생 다음 명령으로 넘어간다.
    - 중단: (segement default, runtime error 등등..)
    - 소프트웨어 인터럽트: 시스템 콜 발생시

### 하드웨어(비동기) 인터럽트

- 하드웨어 동작과 같은 비동기 작업을 할 때 발생한다
- 입출력 장치가 완료된 경우 해당 장치는 CPU에게 비동기 인터럽트를 발생시킨다
- CPU가 하드웨어의 완료 여부를 지속적으로 확인하는 pooling 방식은 비효율적이다.

### 하드웨어 인터럽트 처리 순서

1. IO장치는 CPU에 인터럽트 요청 신호를 보낸다
2. CPU는 매 실행 사이클을 종료 후 인터럽트 여부를 확인한다
3. CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 인터럽트 수용 여부를 확인한다
4. 인터럽트 수용이 가능하다면 CPU는 현재 작업을 백업한다(메모리 스택에)
5. CPU는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 수행한다
6. 인터럽트 서비스 루틴이 종료되면 스택에 저장해둔 이전 작업 상태를 복구한다